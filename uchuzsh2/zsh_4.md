# zshでコマンドライン履歴を活用する

date
:  2015/05/04

author
:   三宅 英明(mollifier)

theme
:   ligntning-gl-sample

# 自己紹介

- 名前: 三宅 英明
- Twitter: @mollifier
- はてなID: mollifier
- 神戸のプログラマ

![](images/usagi-kao-kiritori.png){:caption="" relative_height="60" align="right"}

# 好きなもの
- zsh
- vim
- vimperator

![](images/usagi-kao-kiritori.png){:caption="" relative_height="60" align="right"}

# ブログとか
はてなブログ
:    http://mollifier.hatenablog.com/

Twitter
:    http://twitter.com/mollifier

Qiita
:    http://qiita.com/mollifier

# zshでコマンドライン履歴を活用する
- コマンドライン履歴とは
- 実行したコマンドを覚えていて、後から使えるやつ

# コマンドライン履歴
- 過去に入力したコマンドをもう一度入力したいことが、けっこうある

# コマンドライン履歴
- 毎日のように使うコマンドで、決まりきったパターンを何回も入力するのがめんどう
- だいぶ前に入力したあのコマンドをもう一度使いたいけど、引数の指定とか忘れてしまった

# コマンドライン履歴
- そんなときはコマンドライン履歴を使えばOK
- 1回入力したコマンドラインを覚えておいて、あとから使える

# コマンドライン履歴を保存する
とりあえず基本の設定

    HISTFILE=~/.zsh_history
    HISTSIZE=1000000
    SAVEHIST=1000000

# コマンドライン履歴を保存する
- HISTFILEはコマンドライン履歴を保存するファイル名の指定
- 何でもいいけど、~/.zsh_historyとしている人が多いもよう
- 別のファイル名でもいい

# コマンドライン履歴を保存する
- HISTSIZE、SAVEHISTはコマンドライン履歴を何行保存するかの設定
- 普通は同じ値を設定しておけばOK

# コマンドライン履歴を保存する
- 多めの設定を推奨
- 1万とか、なんかセコい

# コマンドライン履歴を保存する
- 目安としては一生使っても使い切れないぐらいの量
- 100万にしたら普通の人は100年使っても足りるので、だいたいそれぐらいでOK
- 気前よく1億とかにしてもOK

# コマンドライン履歴を保存する
- これでコマンドライン履歴が保存されるようになる

# コマンドライン履歴のためのオプション
これも足しておいたほうがいい

    setopt share_history
    setopt hist_ignore_all_dups

# コマンドライン履歴のためのオプション
- `setopt share_history`
- 同時に起動したzshの間でヒストリを共有する

# コマンドライン履歴のためのオプション
- `setopt hist_ignore_all_dups`
- 同じコマンドをヒストリに残さない

# コマンドライン履歴
これで準備完了

# コマンドライン履歴を活用する
- 保存するだけでは意味がない
- 保存したやつを後から便利に使う方法を紹介する

# コマンドライン履歴の活用(1)
コマンドライン履歴を閲覧するには、historyコマンドを使う

    % history
    2880  cd
    2881  ls
    2882  cd work
    2883  git status

# コマンドライン履歴の活用(1)
- `history`コマンドで、最近16件の履歴が表示される

# コマンドライン履歴の活用(1)
全件表示したいときは引数を付ける

    % history 1
    1   mkdir work
    2   ls
    3   cd work
    ...

# コマンドライン履歴の活用(1)
- `history 番号`で、表示を開始する番号を指定する
- マイナスの番号も指定できる。例えば`history -10`で最近10件の履歴を表示する

# コマンドライン履歴の活用(1)
- 特に`history 1`で、すべてのコマンドライン履歴を表示する

# コマンドライン履歴の活用(1)
もう一つ大事なオプション。`history -n`で、履歴の番号を表示しなくなる

    % history -n
    cd
    ls
    cd work
    git status

# コマンドライン履歴の活用(1)
これで履歴を表示して、grepで検索する

    % history -n 1 | grep 'git'
    git commit
    git init
    git commit --ammend
    ...

# コマンドライン履歴の活用(1)
- 汎用的。シェルの種類は関係ない
- あんまりお手軽ではない
- でも、正規表現で細かく条件を指定して探せる

# コマンドライン履歴の活用(1)
こんなaliasを設定しておくと便利

    alias history-all='history -n 1'

# コマンドライン履歴の活用(2)
- インクリメンタル検索する
- 標準のCtrl+rで使える

# コマンドライン履歴の活用(2)
- デモ

# コマンドライン履歴の活用(2)
これを~/.zshrcに書くと、インクリメンタル検索でパターンマッチが使えるようになる

    bindkey '^R' history-incremental-pattern-search-backward

# コマンドライン履歴の活用(2)
記号としては、次の2つを覚えておけばOK

|記号|意味|
|:---|:---|
|*|長さ0以上の任意の文字列|
|^|コマンドラインの先頭|

# コマンドライン履歴の活用(3)
今の入力を元にコマンドライン履歴から補完する

    autoload -Uz history-search-end
    zle -N history-beginning-search-backward-end \
      history-search-end
    bindkey "^O" history-beginning-search-backward-end

# コマンドライン履歴の活用(3)
- 言葉では説明しにくいのでデモを見せる

# コマンドライン履歴の活用(3)
- これが便利
- キーバインドはお好みで

# コマンドライン履歴を活用する
- grepで全件から検索
- インクリメンタル検索
- 今の入力を元に履歴から補完
- とりあえずこれぐらいでOK

# コマンドライン履歴を活用する
- コマンドライン履歴は、自分がシェルを使った記録が保存されている大事なデータ
- ブックマークやスニペットのようなもの

# コマンドライン履歴を活用する
- もう、1回入力したコマンドは2度と手入力しない
- 2回入力してしまったら死ぬ、ぐらいの勢いで

# コマンドライン履歴を活用する
- 細かい引数とかを覚えてなくてもコマンドが使えるようになる
- シェルの操作が速く、確実になるので、上手に活用してください

# zshでコマンドライン履歴を活用する
- ありがとうございました

